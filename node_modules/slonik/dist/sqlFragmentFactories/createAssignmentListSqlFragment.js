"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _lodash = require("lodash");

var _utilities = require("../utilities");

var _factories = require("../factories");

const createAssignmentListSqlFragment = (token, greatestParameterPosition) => {
  let placeholderIndex = greatestParameterPosition;
  const values = [];
  const sql = Object.entries(token.namedAssignment).map(([column, value]) => {
    if ((0, _utilities.isSqlToken)(value)) {
      // $FlowFixMe
      const sqlFragment = (0, _factories.createSqlTokenSqlFragment)(value, placeholderIndex);
      placeholderIndex += sqlFragment.values.length;
      values.push(...sqlFragment.values);
      return (0, _utilities.escapeIdentifier)((0, _lodash.snakeCase)(column)) + ' = ' + sqlFragment.sql;
    } else {
      // $FlowFixMe
      values.push(value); // @todo `snakeCase` is opinionated modification assignment expression modification.
      // Add a way to override the default behaviour, e.g. by allowing AssignmentListTokenType
      // key to be sql.identifier.

      return (0, _utilities.escapeIdentifier)((0, _lodash.snakeCase)(column)) + ' = $' + ++placeholderIndex;
    }
  }).join(', ');
  return {
    sql,
    values
  };
};

var _default = createAssignmentListSqlFragment;
exports.default = _default;
//# sourceMappingURL=createAssignmentListSqlFragment.js.map